<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Add / Edit Product</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f5f7fa;
    margin: 0;
    padding: 0;
  }
  body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f4f6f8;
        margin: 20px;
    }
    h1 { text-align: center; margin-bottom: 20px; }

    table {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
        padding: 12px 15px;
        text-align: left;
        vertical-align: middle;
    }
    th { background-color: #007BFF; color: #fff; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    tr:hover { background-color: #d0e7ff; }
    .price { color: green; font-weight: bold; }
    .mrp { text-decoration: line-through; color: #888; }

    /* Buttons */
    .action-btn {
        padding: 6px 12px;
        margin: 0 2px;
        border: 2px solid transparent;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        display: inline-block;
        min-width: 60px;
        text-align: center;
        transition: all 0.3s ease;
        color: #fff;
    }
    .view-btn { background-color: #28a745; }
    .edit-btn { background-color: #ffc107; color: #000; }
    .delete-btn { background-color: #dc3545; }

    .view-btn:hover { border: 2px solid #28a745; }
    .edit-btn:hover { border: 2px solid #ffc107; }
    .delete-btn:hover { border: 2px solid #dc3545; }


  /* Modal Base */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    overflow-y: auto;
  }

  .modal-content {
    background: #fff;
    width: 80%;
    max-width: 800px;
    margin: 50px auto;
    border-radius: 10px;
    padding: 20px 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    position: relative;
  }

  .modal-content h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
  }

  .close {
    position: absolute;
    right: 15px;
    top: 10px;
    font-size: 24px;
    cursor: pointer;
    color: #555;
  }

  .close:hover {
    color: red;
  }

  form {
    display: flex;
    flex-direction: column;
  }

  .form-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }

  .form-group {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .form-group.full-width {
    width: 100%;
  }

  label {
    font-weight: 600;
    margin-bottom: 5px;
    color: #333;
  }

  input, select, textarea {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 8px;
    font-size: 14px;
    outline: none;
  }

  input:focus, select:focus, textarea:focus {
    border-color: #007bff;
  }

  textarea {
    resize: vertical;
  }

  .btn-row {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
  }

  .btn {
    border: 2px solid transparent;
    border-radius: 6px;
    padding: 8px 20px;
    font-size: 15px;
    cursor: pointer;
    transition: 0.3s;
  }

  .btn.save {
    background: #007bff;
    color: #fff;
    border-color: #007bff;
  }

  .btn.save:hover {
    background: #0056b3;
  }

  .btn.cancel {
    background: #fff;
    color: #444;
    border: 2px solid #ccc;
  }

  .btn.cancel:hover {
    border-color: #999;
  }

  /* Trigger button for demo */
  .trigger-btn {
    margin: 30px;
    padding: 10px 20px;
    border: none;
    background: #28a745;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }

  .trigger-btn:hover {
    background: #218838;
  }
 #manageItemsLink {
  display: inline-block;
  padding: 10px 20px;
  background-color: #007BFF; /* Blue color */
  color: #fff;
  font-weight: 600;
  border-radius: 5px;
  text-decoration: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
  user-select: none;
  float: right;
  margin-bottom: 10px;
}

#manageItemsLink:hover,
#manageItemsLink:focus {
  background-color: #0056b3; /* Darker blue on hover/focus */
  outline: none;
}


 #adminindexpage {
  display: inline-block;
  padding: 10px 20px;
  background-color: #5de17a; /* Blue color */
  color: #fff;
  font-weight: 600;
  border-radius: 5px;
  text-decoration: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
  user-select: none;
  float: left;
  margin-bottom: 10px;
}

#adminindexpage:hover,
#adminindexpage:focus {
  background-color: #0d581d; /* Darker blue on hover/focus */
  outline: none;
}


</style>
</head>

<body>
  <button id="adminindexpage">Back To Home</button>
<button id="manageItemsLink">Add Product</button>


<div class="container">
    <table id="productTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Product Name</th>
                <th>Color</th>
                <th>Material</th>
                <th>MRP</th>
                <th>Price</th>
                <th>Dimensions (HÃ—WÃ—D)</th>
                <th>Weight Limit</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>



  <!-- ========== PRODUCT MODAL (Add + Edit Shared) ========== -->
<!-- Product Add Modal -->
<div id="productModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Add New Product</h2>
    <form id="productForm">

      <!-- Row 1 -->
      <div class="form-row">
        <div class="form-group">
          <label>Product Name</label>
          <input type="text" name="productName" placeholder="Product Name" required>
        </div>
        <div class="form-group">
          <label>Brand</label>
          <input type="text" name="brand" placeholder="Brand">
        </div>
      </div>

      <!-- Row 2 -->
      <div class="form-row">
        <div class="form-group">
          <label>Colour</label>
          <input type="text" name="colour" placeholder="Colour">
        </div>
        <div class="form-group">
          <label>Material</label>
          <input type="text" name="material" placeholder="Material">
        </div>
      </div>

      <!-- Row 3 -->
      <div class="form-row">
        <div class="form-group">
          <label>Recommended Uses</label>
          <input type="text" name="recommendedUsesFor" placeholder="Recommended Uses For">
        </div>
        <div class="form-group">
          <label>Special Feature</label>
          <input type="text" name="specialFeature" placeholder="Special Feature">
        </div>
      </div>

      <!-- Row 4 -->
      <div class="form-row">
        <div class="form-group">
          <label hidden>Door Style</label>
          <input type="text" name="doorStyle" placeholder="Door Style" hidden>
        </div>
        <div class="form-group">
          <label>Weight Limit</label>
          <input type="number" name="weightLimit" placeholder="Weight Limit" step="0.01">
        </div>
      </div>

      <!-- Full width fields -->
      <div class="form-group full-width">
        <label>Product Summary</label>
        <textarea name="productSummery" placeholder="Product Summary"></textarea>
      </div>

      <div class="form-group full-width">
        <label>Product Type</label>
        <select name="productType" id="productTypeDropdown" required>
          <option value="">-- Select Product Type --</option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>MRP</label>
          <input type="number" name="productMrp" placeholder="MRP" step="0.01" required>
        </div>
        <div class="form-group">
          <label>Price</label>
          <input type="number" name="productPrice" placeholder="Price" step="0.01" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Height</label>
          <input type="number" name="height" placeholder="Height" step="0.01">
        </div>
        <div class="form-group">
          <label>Width</label>
          <input type="number" name="width" placeholder="Width" step="0.01">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Depth</label>
          <input type="number" name="diameter" placeholder="Diameter" step="0.01">
        </div>
<div class="form-group">
  <label>Upload PDF</label>
  <input type="file" name="productPdf" id="productPdf" accept="application/pdf">
    <div style="margin-top:5px;">
    <input type="checkbox" id="updatePdfCheckbox">
    <label for="updatePdfCheckbox">Update PDF</label>
  </div>
  <div id="pdfPreview" style="margin-top:5px;"></div>


</div>

<!-- Video Upload Section -->
<div class="form-group">
  <label>Upload Video</label>
  <input type="file" name="productVideo" id="productVideo" accept="video/*">
    <div style="margin-top:5px;">
    <input type="checkbox" id="updateVideoCheckbox">
    <label for="updateVideoCheckbox">Update Video</label>
  </div>
  <div id="videoPreview" style="margin-top:5px;"></div>


</div>

    <div class="form-group">
  <label>Upload Images</label>
  <input type="file" name="productImages" id="productImages" multiple accept="image/*">
  <div style="margin-top:5px;" id="check">
    <input type="checkbox" id="updateImagesCheckbox">
    <label for="updateImagesCheckbox">Update Images</label>
  </div>
</div>

      </div>
    <div class="form-group" style="display: inline;" id="buttoncont">
      <button type="button" class="cancle"  style="float: left !important;width: 50%;padding:8px 20px;border-radius:6px;background-color: red;">Cancel</button>
      <button type="submit" class="submit" style="float: right !important;width: 50%;padding:8px 20px;border-radius:6px;background-color: greenyellow;">Save</button>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const tableBody = document.querySelector('#productTable tbody');

    try {
        const response = await fetch('https://localhost:7065/api/Productsontroller/GetAllProducts');
        const data = await response.json();

        if (data.statusCode !== 200 || !data.responseData?.length) {
            tableBody.innerHTML = '<tr><td colspan="9" style="text-align:center;">No products found</td></tr>';
            return;
        }

        data.responseData.forEach(product => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${product.id}</td>
                <td>${product.productName}</td>
                <td>${product.colour}</td>
                <td>${product.material}</td>
                <td class="mrp">â‚¹${product.productMrp}</td>
                <td class="price">â‚¹${product.productPrice}</td>
                <td>${product.height}Ã—${product.width}Ã—${product.diameter}</td>
                <td>${product.weightLimit}</td>
                <td style="display: inline-flex;">
                    <!--<button class="action-btn view-btn" onclick="viewProduct(${product.id})">View</button>--> 
                    <button class="action-btn edit-btn" onclick="editProduct(${product.id})">Edit</button>
                    <button class="action-btn delete-btn" onclick="deleteProduct(${product.id})">Delete</button>
                </td>`;
            tableBody.appendChild(tr);
        });
    } catch (err) {
        console.error(err);
        tableBody.innerHTML = '<tr><td colspan="9" style="text-align:center;color:red;">Failed to load products</td></tr>';
    }
});


document.addEventListener('DOMContentLoaded', function() {
  async function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
    });
}

    const modal = document.getElementById('productModal');
    const openBtn = document.getElementById('manageItemsLink');
    const closeBtn = modal.querySelector('.close');
      const cancelBtn = modal.querySelector('.cancle');
    const form = document.getElementById('productForm');
      const formbutton = document.getElementById('buttoncont');
    const productTypeDropdown = document.getElementById('productTypeDropdown');
    const saveBtn = form.querySelector('.submit');
    const imageInput = document.getElementById('productImages');

    // Preview container for existing images
    let imagePreview = document.createElement('div');
    imagePreview.id = 'imagePreview';
    imagePreview.style.marginTop = '10px';
    
    form.querySelector('[name="productImages"]').parentElement.appendChild(imagePreview);
// ðŸŽ¥ Video preview
const videoInput = document.getElementById('productVideo');
const videoPreview = document.getElementById('videoPreview');

videoInput.addEventListener('change', function() {
  videoPreview.innerHTML = ''; // Clear old preview
  const file = this.files[0];
  if (!file) return;

  const videoUrl = URL.createObjectURL(file);
  const videoElem = document.createElement('video');
  videoElem.src = videoUrl;
  videoElem.controls = true;
  videoElem.width = 300;
  videoElem.style.marginTop = '10px';
  videoElem.style.borderRadius = '6px';
  videoElem.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
  videoPreview.appendChild(videoElem);
});

    let updateBtn = document.createElement('button');
    updateBtn.textContent = 'Update';
    updateBtn.className = 'btn update';
    updateBtn.style.cssText = 'background:#28a745;color:#fff;border:none;padding:8px 20px;border-radius:6px;float: right !important;width: 50%;';
    formbutton.appendChild(updateBtn);

    let currentEditingId = null;

    // Load product types
    async function loadProductTypes(selectedId = null) {
        try {
            const response = await fetch('https://giriwebapis.runasp.net/api/CommonDropdown/GetProductTypeDrop');
            if (!response.ok) throw new Error('Failed to load product types');
            const data = await response.json();
            productTypeDropdown.innerHTML = '<option value="">-- Select Product Type --</option>';
            data.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = item.productType;
                if (selectedId && selectedId === item.id) opt.selected = true;
                productTypeDropdown.appendChild(opt);
            });
        } catch (err) {
            console.error('Error loading product types:', err);
            alert('Failed to load product types');
        }
    }

    // Open modal for Add
openBtn.addEventListener('click', function(e) {
  e.preventDefault();

  // Hide update checkboxes (PDF, Video, Images)
  document.getElementById('updatePdfCheckbox').parentElement.style.display = 'none';
  document.getElementById('updateVideoCheckbox').parentElement.style.display = 'none';
  document.getElementById('check').style.display = 'none';

  // Clear all previews
  document.getElementById('pdfPreview').innerHTML = '';
  document.getElementById('videoPreview').innerHTML = '';
  imagePreview.innerHTML = '';

  // Reset form
  form.reset();

  // Switch to Add Mode
  saveBtn.style.display = 'inline-block';
  updateBtn.style.display = 'none';
  modal.querySelector('h2').textContent = 'Add New Product';
  modal.style.display = 'block';
  currentEditingId = null;

  loadProductTypes();
});

    // Close modal
     cancelBtn.addEventListener('click', () => modal.style.display = 'none');
    window.addEventListener('click', event => {
        if (event.target === modal) modal.style.display = 'none';
    });
    closeBtn.addEventListener('click', () => modal.style.display = 'none');
    window.addEventListener('click', event => {
        if (event.target === modal) modal.style.display = 'none';
    });

    // Add product
// Add product
// ðŸ”§ Converts any file to Base64 string
async function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result.split(',')[1]);
    reader.onerror = error => reject(error);
  });
}

form.addEventListener('submit', async function (e) {
  e.preventDefault();
  if (currentEditingId) return; // prevent if in edit mode

  const formData = new FormData(form);
  const productData = {};

  formData.forEach((value, key) => {
    if (['productType', 'productMrp', 'productPrice', 'height', 'width', 'diameter', 'weightLimit', 'CreatedBy', 'ModifiedBy'].includes(key)) {
      productData[key] = Number(value);
    } else if (key !== 'productImages' && key !== 'productPdf' && key !== 'productVideo') {
      productData[key] = value;
    }
  });

  // Handle PDF
  const pdfFile = document.getElementById('productPdf').files[0];
  if (pdfFile) {
    productData.fileName = pdfFile.name;
    productData.fileData = await toBase64(pdfFile);
  }

  // Handle Video
  const videoFile = document.getElementById('productVideo').files[0];
  if (videoFile) {
    productData.videoFileName = videoFile.name;
    productData.videoFileData = await toBase64(videoFile);
  }

  productData.CreatedDate = new Date().toISOString();
  productData.IsDeleted = false;
  productData.CreatedBy = 1;

  console.log("ðŸ“¤ Sending product data to API:", productData);

  try {
    const productResponse = await fetch('https://localhost:7065/api/Productsontroller/AddNewProducts', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(productData)
    });

    const productResult = await productResponse.json();
    if (productResult.statusCode === 200) {
      const productId = productResult.responseData;

      const imageInput = document.getElementById('productImages');
      if (imageInput.files.length > 0) {
        const imagesForm = new FormData();
        for (let i = 0; i < imageInput.files.length; i++) {
          imagesForm.append('images', imageInput.files[i]);
        }
        await fetch(`https://localhost:7065/api/Productsontroller/api/products/${productId}/images`, {
          method: 'POST',
          body: imagesForm
        });
      }

      alert('âœ… Product added successfully!');
      modal.style.display = 'none';
      form.reset();
      location.reload();
    } else {
      alert(productResult.statusMessage || 'Something went wrong while adding product');
    }
  } catch (err) {
    console.error('âŒ Error sending product:', err);
    alert('Error connecting to API');
  }
});
// ====================== UPDATE PRODUCT HANDLER ======================
updateBtn.addEventListener('click', async function() {
  const formData = new FormData(form);
  const updatedProduct = { id: currentEditingId };

  // Convert all normal form fields to object
  formData.forEach((value, key) => {
    if (['productType', 'productMrp', 'productPrice', 'height', 'width', 'diameter', 'weightLimit', 'CreatedBy', 'ModifiedBy'].includes(key)) {
      updatedProduct[key] = Number(value);
    } else if (key !== 'productImages' && key !== 'productPdf' && key !== 'productVideo') {
      updatedProduct[key] = value;
    }
  });

  // ðŸ§  Basic info
  updatedProduct.modifiedBy = 1;
  updatedProduct.modifiedDate = new Date().toISOString();
  updatedProduct.createdDate = new Date().toISOString();
  updatedProduct.isDeleted = false;
  updatedProduct.createdBy = 1;

  // ====================== PDF HANDLING ======================
  const pdfInput = document.getElementById('productPdf');
  const updatePdfChecked = document.getElementById('updatePdfCheckbox').checked;

  if (updatePdfChecked && pdfInput.files.length > 0) {
    // âœ… User selected to update PDF
    const pdfFile = pdfInput.files[0];
    updatedProduct.fileName = pdfFile.name;
    updatedProduct.fileData = await toBase64(pdfFile);
  } else if (existingPdfData && existingPdfName) {
    // âœ… Keep old PDF
    updatedProduct.fileName = existingPdfName;
    updatedProduct.fileData = existingPdfData;
  } else {
    // No existing or new PDF
    updatedProduct.fileName = null;
    updatedProduct.fileData = null;
  }

  // ====================== VIDEO HANDLING ======================
  const videoInput = document.getElementById('productVideo');
  const updateVideoChecked = document.getElementById('updateVideoCheckbox').checked;

  if (updateVideoChecked && videoInput.files.length > 0) {
    // âœ… User selected to update video
    const videoFile = videoInput.files[0];
    updatedProduct.videoFileName = videoFile.name;
    updatedProduct.videoFileData = await toBase64(videoFile);
  } else if (existingVideoData && existingVideoName) {
    // âœ… Keep old video
    updatedProduct.videoFileName = existingVideoName;
    updatedProduct.videoFileData = existingVideoData;
  } else {
    // No existing or new video
    updatedProduct.videoFileName = null;
    updatedProduct.videoFileData = null;
  }

  // ====================== IMAGE HANDLING ======================
  const imageInput = document.getElementById('productImages');
  const updateImagesChecked = document.getElementById('updateImagesCheckbox').checked;

  // âœ… API Call to update product details
  console.log("ðŸ“¤ Updating Product:", updatedProduct);
  try {
    const res = await fetch('https://localhost:7065/api/Productsontroller/UpdateProduct', {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updatedProduct)
    });

    const result = await res.json();

    if (result.statusCode === 200) {
      // ====================== UPLOAD IMAGES IF NEEDED ======================
      if (updateImagesChecked && imageInput.files.length > 0) {
        const imagesForm = new FormData();
        for (let i = 0; i < imageInput.files.length; i++) {
          imagesForm.append('images', imageInput.files[i]);
        }

        await fetch(`https://localhost:7065/api/Productsontroller/api/products/${currentEditingId}/images?isupdate=true`, {
          method: 'POST',
          body: imagesForm
        });
      } else {
        // keep existing images â€” no upload needed
        console.log("ðŸ–¼ Keeping existing images.");
      }

      alert('âœ… Product updated successfully!');
      modal.style.display = 'none';
      form.reset();

      // Reset existing file vars
      existingPdfData = null;
      existingPdfName = null;
      existingVideoData = null;
      existingVideoName = null;

      location.reload();
    } else {
      alert(result.statusMessage || 'âŒ Update failed');
    }
  } catch (error) {
    console.error('âŒ Error updating product:', error);
    alert('Error connecting to API.');
  }
});

// ðŸª„ Optional: Auto-check update boxes when selecting new files
document.getElementById('productPdf').addEventListener('change', () => {
  document.getElementById('updatePdfCheckbox').checked = true;
});

document.getElementById('productVideo').addEventListener('change', () => {
  document.getElementById('updateVideoCheckbox').checked = true;
});
 // GLOBAL: Edit product function
// ðŸ”§ EDIT PRODUCT FUNCTION
window.editProduct = async function(id) {
    try {
        const checkid = document.getElementById('check');
        checkid.style.display = 'inline';
// Show update checkboxes when editing
document.getElementById('updatePdfCheckbox').parentElement.style.display = 'block';
document.getElementById('updateVideoCheckbox').parentElement.style.display = 'block';
document.getElementById('check').style.display = 'block';

        const res = await fetch(`https://localhost:7065/api/Productsontroller/GetAllProductsById?Id=${id}`);
        const data = await res.json();
          console.log(data);
        if (data.statusCode === 200 && data.responseData) {
            const p = data.responseData;

            modal.style.display = 'block';
            modal.querySelector('h2').textContent = 'Edit Product';
            saveBtn.style.display = 'none';
            updateBtn.style.display = 'inline-block';
            currentEditingId = p.id;

            await loadProductTypes(p.productType);

            // Fill form fields
            form.productName.value = p.productName || '';
            form.brand.value = p.brand || '';
            form.colour.value = p.colour || '';
            form.material.value = p.material || '';
            form.recommendedUsesFor.value = p.recommendedUsesFor || '';
            form.specialFeature.value = p.specialFeature || '';
            form.doorStyle.value = p.doorStyle || '';
            form.weightLimit.value = p.weightLimit || '';
            form.productSummery.value = p.productSummery || '';
            form.productType.value = p.productType || '';
            form.productMrp.value = p.productMrp || '';
            form.productPrice.value = p.productPrice || '';
            form.height.value = p.height || '';
            form.width.value = p.width || '';
            form.diameter.value = p.diameter || '';

            // ========== ðŸ“¸ Show existing images ==========
            imagePreview.innerHTML = '';
            if (p.productimages && p.productimages.length > 0) {
                const label = document.createElement('p');
                label.textContent = "Existing Images:";
                label.style.fontWeight = '600';
                label.style.marginBottom = '5px';
                imagePreview.appendChild(label);

                p.productimages.forEach(img => {
                    const imgElem = document.createElement('img');
                    imgElem.src = `data:image/png;base64,${img.imageData}`;
                    imgElem.alt = img.imageName;
                    imgElem.title = img.imageName;
                    imgElem.style.cssText =
                        'width:70px;height:70px;margin-right:5px;border-radius:5px;border:1px solid #ccc;';
                    imagePreview.appendChild(imgElem);
                });
            } else {
                imagePreview.innerHTML = '<p style="color:#777;">No images uploaded yet.</p>';
            }

          const pdfPreview = document.getElementById('pdfPreview');
pdfPreview.innerHTML = '';

const pdfData = p.pdfFileDate || p.pdfFileData || p.PdfFileData;
const pdfName = p.pdfFileName || p.PdfFileName;

if (pdfName && pdfData) {
  const label = document.createElement('p');
  label.textContent = "Existing PDF:";
  label.style.fontWeight = '600';
  pdfPreview.appendChild(label);

  const pdfLink = document.createElement('a');
  pdfLink.href = `data:application/pdf;base64,${pdfData.replace(/\s/g, '')}`;
  pdfLink.textContent = pdfName;
  pdfLink.download = pdfName;
  pdfLink.target = "_blank";
  pdfLink.style.color = "#007bff";
  pdfLink.style.textDecoration = "underline";
  pdfPreview.appendChild(pdfLink);
} else {
  pdfPreview.innerHTML = '<p style="color:#777;">No PDF uploaded yet.</p>';
}



            // ========== ðŸŽ¥ Show existing Video ==========
            const videoPreview = document.getElementById('videoPreview');
            videoPreview.innerHTML = '';
            if (p.videoFileName && p.videoFileData) {
                const label = document.createElement('p');
                label.textContent = "Existing Video:";
                label.style.fontWeight = '600';
                label.style.marginBottom = '5px';
                videoPreview.appendChild(label);

                const vidElem = document.createElement('video');
                vidElem.src = `data:video/mp4;base64,${p.videoFileData}`;
                vidElem.controls = true;
                vidElem.width = 300;
                vidElem.style.marginTop = '5px';
                vidElem.style.borderRadius = '6px';
                vidElem.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
                videoPreview.appendChild(vidElem);

                const vidName = document.createElement('div');
                vidName.textContent = p.videoFileName;
                vidName.style.marginTop = '5px';
                vidName.style.fontSize = '13px';
                vidName.style.color = '#555';
                videoPreview.appendChild(vidName);
            } else {
                videoPreview.innerHTML = '<p style="color:#777;">No video uploaded yet.</p>';
            }

        } else {
            alert('Failed to fetch product details');
        }
    } catch (err) {
        console.error(err);
        alert('Error fetching product details');
    }
};
});
window.deleteProduct = async function (id) {
    if (!confirm("Are you sure you want to delete this product?")) return;

    try {
        const res = await fetch(`https://localhost:7065/api/Productsontroller/DeleteProduct?Id=${id}`, {
            method: 'DELETE',
        });

        const data = await res.json();

        if (data.statusCode === 200) {
            alert('Product deleted successfully!');
            location.reload();
        } else {
            alert(data.statusMessage || 'Failed to delete product.');
        }
    } catch (error) {
        console.error('Error deleting product:', error);
        alert('An error occurred while deleting the product.');
    }
};
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const homeBtn = document.getElementById('adminindexpage');
  homeBtn.addEventListener('click', function() {
    window.location.href = "adminindexpage.html"; // Change this to your homepage path
  });
  
  // ... rest of your existing JS code ...
});
</script>

</body>
</html>
